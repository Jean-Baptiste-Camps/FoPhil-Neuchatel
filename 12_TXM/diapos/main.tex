% !TeX spellcheck = fr
% !TeX encoding = UTF-8
\documentclass{beamer}

\usepackage{fontspec}
\usepackage{xltxtra}

%\usetheme{Boadilla}
\usetheme{PaloAlto}
%\usetheme{Berlin}
%\usecolor{}

%\usepackage{minted}

%\setmainfont{Linux Libertine O}
\usepackage[english,french]{babel}

%Un peu de config de Beamer
\setbeamersize{description width=0.47cm}


\usepackage{hyperref}

\usepackage{graphicx}

\institute{Univ. de Neuchâtel}

\title{Exploiter les données}
\subtitle{Introduction à la textométrie avec \textsc{txm}}
\author{Jean-Baptiste Camps \& Simon Gabay}
\date[FoPhil -- 14 févr. 2018]{Formation en philologie numérique:\\ encoder, exploiter, diffuser\\
12-16 février 2018}

\makeatletter 
         
        \AtBeginSection[]{% 
        \begin{frame}{Plan}%
        \small
        \tableofcontents[currentsection]%
        \end{frame} }

        %\AtBeginSubsection[]{% 
	%\begin{frame}{Plan}%
	%\small
	%\tableofcontents[currentsection,currentsubsection]%
%\end{frame} }


\makeatother 
    
    
\begin{document}

\maketitle
%\frontmatter 
  

\begin{frame}{De la production des données à l'exploitation}
	
	\begin{columns}[T]
		
		\begin{column}{0.62\textwidth}
			
			\textsc{Ceux-ci collectent les données}
			
			\centering
			
			\includegraphics[width=\textwidth]{img/vendange.jpg}
			
		\end{column}
			\begin{column}{0.38\textwidth}
		
		\textsc{Ceux-là les exploitent}
		
		\centering
		
		\includegraphics[width=\textwidth]{img/vin2.jpg}
		
	\end{column}
		
	\end{columns}
	
\end{frame}

%\mainmatter 

\begin{frame}{Objectifs}
	
	\begin{itemize}
		\item S'initier à la \alert{textométrie},
		\begin{itemize}
			\item créer des corpus;
			\item les interroger;
			\item faire (un peu) d'analyse quantitative.
		\end{itemize}
		\item dans le cadre d'un logiciel ``tout en un'' et convivial, 
	\alert{\textsc{txm}} \cite{Heiden2010},
		\item sur des cas tirés de la littérature du XVII\ieme{} siècle.
	\end{itemize}


\begin{block}{La textométrie selon \cite{Pincemin2008}}
	\begin{quote}
		La   textométrie développe  les  possibilités  de  consultation  et  d'analyse  de
		corpus  textuels  en  faisant  appel  à  des  décomptes  et des
		modélisations  statistiques  et  en  combinant  aux  possibilités
		de repérage d'occurrences des calculs de tri, de sélection et
		de réorganisation statistique.
	\end{quote}
\end{block}
	
\end{frame}


\begin{frame}[fragile]
\frametitle{\textsc{txm}: un logiciel de textométrie}


\begin{columns}
	\begin{column}{0.30\textwidth}
	\begin{center}
	\includegraphics[width= 0.8\textwidth]{img/txm.png}
	\end{center}

\url{http://textometrie.ens-lyon.fr/}

\textit{Base de français médiéval:} \url{http://txm.bfm-corpus.org/}.
	\end{column}
	\begin{column}{0.66\textwidth}
		\begin{itemize}
			\item Logiciel libre et multiplateforme;
			\item développé à l'ÉNS-LSH de Lyon;
			\item dévoué à la textométrie;
			\item repose sur des technologies de référence:
				\begin{itemize}
					\item \textsc{xml/tei} pour les données;
					\item \textsc{r} pour l'analyse statistique;
					\item \textsc{cqp} pour l'interrogation de corpus;
					\item \texttt{TreeTagger} pour l'annotation.
				\end{itemize}
		\end{itemize}
	\end{column}
\end{columns}
\end{frame}


\begin{frame} 
  \frametitle{Plan} 
  \tableofcontents
\end{frame}

\section{Mise en jambe: \textit{Andromaque}}

\begin{frame}{Création d'un corpus à partir de notre édition d'\textit{Andromaque}}

\begin{enumerate}
	\item Fichier, importer, import XML/W + CSV;
	\item sélectionner le dossier avec les sources et remplir les paramètres du corpus;
	\item lancer la création du corpus.
\end{enumerate}

\end{frame}

\begin{frame}{Premières fonctionnalités}
\begin{enumerate}
\item Consulter la description du corpus;
\item parcourir l'édition;
\item regarder le lexique;
\item ouvrir l'index, y chercher les occurrences de 'Seigneur';
	\begin{enumerate}
		\item clic-droit, envoyer vers les concordances;
			\begin{enumerate}
				\item double-clic sur une occurrence pour aller au texte;
			\end{enumerate}
		\item clic-droit, envoyer vers les cooccurrents;
			\begin{enumerate}
				\item aller d'un cooccurrent aux concordances, puis au texte
			\end{enumerate}
		\item clic-droit, envoyer vers la progression;
	\end{enumerate}
\end{enumerate}

\end{frame}

\begin{frame}{Partitions et quelques éléments descriptifs}
\begin{enumerate}
\item créer une partition, en sélectionnant la structure \texttt{sp} et l'attribut \texttt{\@who};
\item consulter les dimensions;
\item créer une table lexicale, expérimenter avec les tris, la fusion ou suppression des colonnes, etc.
\end{enumerate}
\end{frame}

\begin{frame}{Statistiques de base}
À partir de la table lexicale créée,
\begin{enumerate}
\item calculer les spécificités;
\item quels sont les mots les plus spécifiques d'Oreste? de Pylade?
\item en sélectionner quelques uns qui sont pertinents;
\item calculer le diagramme en bâton des lignes sélectionnées.
\end{enumerate}
\end{frame}

\begin{frame}{Qu'en déduire?}
	
	\includegraphics[width=\textwidth]{img/graphique_word_Oreste.png}
	
\end{frame}

%TODO: ajouter formule et expliquer maths des spécificités, si temps.


\frame{Prêts à passer aux choses sérieuses?}

\section{Importer des données et créer un corpus}

\begin{frame}{Différents modes d'import}
	
	\begin{description}
		\item[flemmards] import (avec ou sans métadonnées complémentaires)
		depuis 
		\begin{itemize}
			\item presse-papier;
			\item des fichiers \texttt{txt} ;
			\item traitement de texte.
		\end{itemize}
		\item[XML] XML/ TEI ou autre;
		\item[spécifiques] formats de logiciels de textométrie.
	\end{description}
	
\end{frame}

% Le corpus

\begin{frame}[fragile]
\frametitle{Corpus du jour: un peu de théâtre du XVII\ieme{} siècle}

Corpus constitué pour le cours d'aujourd'hui:

\begin{itemize}
	\item source: Paul Fièvre,  \url{http://www.theatre-classique.fr/};
	\item documents encodés en \textsc{xml}/\textsc{tei} (ou dans plusieurs \textsc{xml/tei});
	\item corpus de \alert{36} pièces de théâtre en vers du XVII\ieme{} siècle,
	\item appartenant à trois genres principaux:
		\begin{itemize}
			\item comédie,
			\item tragédie,
			\item tragi-comédie.
		\end{itemize}
	\item sélectionnées un peu au hasard,
	\begin{itemize}
		\item mais en essayant de conserver un équilibre entre les genres principaux (comédie, tragédie, tragi-comédie),
		\item d'avoir des pièces de longueur similaire (entre 1250 et 2000 vers),
		\item un équilibre entre les auteurs (4 pièces par auteur),
		\item et entre les générations (4 auteurs par génération).
	\end{itemize}
\end{itemize}

\end{frame}

\begin{frame}{9 auteurs, 2 générations}
	%	Auteurs, approximativement de deux générations un peu différentes du XVII\ieme{} siècle,
	\begin{columns}[T]
		\begin{column}{0.45\textwidth}
			G1, c.~1630-1650
			\begin{itemize}
			    \item Pierre Du Ryer \\(fl. 1628-1655);
			    \item Georges de Scudéry\\ (fl. 1631-1643).
				\item Jean de Rotrou\\ (fl. 1635-1649);
				\item Paul Scarron\\ (fl. 1648-1660);
			\end{itemize}
		\end{column}
		\begin{column}{0.45\textwidth}
			G2, c.~1650-1690
			\begin{itemize}
				\item Claude Boyer\\ (fl. 1646-1697);
				\item Thomas Corneille\\ (fl. 1651-1696)
				\item Molière\\ (fl. 1655-1673)
				\item Jean Racine\\ (fl. 1664-1691);
			\end{itemize}
		
		\end{column}
	\end{columns}
	
			Et un monstre sacré, \textbf{Pierre Corneille} (fl. 1629-1675).
	
\end{frame}

\begin{frame}{Sources et pré-traitements}
	
	
	 \begin{itemize}
	 	\item Graphies modernisées (dommage… mais va faire notre affaire dans ce cas précis);
	 	\item Faut-il supprimer la distinction majuscule/minuscule?
	 		\begin{itemize}
	 			\item Pour: suppression de biais éditoriaux.
	 			\item Contre: les majuscules peuvent conserver de l'information syntaxique.
	 		\end{itemize}
 		\item Veut-on garder tout ce qui est extérieur aux répliques (liste des personnages, page de titre, etc.)?
 			\begin{itemize}
 				\item Peut être retiré grâce à la structuration \textsc{xml/tei}.
 			\end{itemize}
	 	\item pas de lemmatisation: possibilité de lemmatiser et annoter automatiquement.
	 \end{itemize}
	
\end{frame}

\begin{frame}[fragile]
\frametitle{Transformations avant l'import}
	
	Dossier \texttt{xsl}, feuille \texttt{source\_to\_txt.xsl} (2.0), deux sorties:
	
	\begin{enumerate}
		\item fichier \texttt{metadata.csv}: métadonnées des documents extraites automatiquement des fichiers \textsc{tei} (\texttt{teiHeader} et page de titre, \texttt{docDate});
		\item dossier \texttt{txt}: transformation en \texttt{txt} des pièces:
			\begin{itemize}
				\item passage en bas de casse;
				\item suppression du \texttt{teiHeader};
				\item suppression du \texttt{castList} et des mentions de personnage, \texttt{speaker};
				\item suppression du \texttt{front}, des \texttt{docTitle}, \texttt{docDate}, \texttt{docAuthor}, \texttt{docImprint}, \texttt{printer}, \texttt{performance}, \verb|div[\@type='dedicace']|;
				\item suppression des titres, notes.
			\end{itemize}
	\end{enumerate}
	
\end{frame}

\begin{frame}{Import \texttt{txt} + \texttt{csv}}
	
	\begin{enumerate}
		\item sélectionner le répertoire de sources \texttt{txm\_import1\_txt} (contenant fichiers \texttt{txt} et métadonnées \texttt{csv},
		corpus tronqué pour gagner un peu de temps);
		\item paramétrer l'import (nommer le corpus THEATRENEUCHTXT);
		\item demander la lemmatisation;
		\item vérifier que les métadonnées sont bien comprises;
		\item lancer l'import;
		\item (regarder le log de l'import);
		\item une fois l'import réussi, jeter un œil à la description, à l'édition, etc.
	\end{enumerate}
	
\end{frame}

% Import XML amélioré, avec XSLT intermédiaire, lemmatisation, etc. etc.

\begin{frame}{Import \texttt{xml/w} + \texttt{csv} amélioré}

\begin{enumerate}
	\item sélectionner le répertoire de sources \texttt{txm\_import2\_xml} (contenant fichiers \texttt{xml} et métadonnées \texttt{csv},
complet);
	\item paramétrer l'import (nommer le corpus THEATRENEUCHXML);
	\item demander la lemmatisation;
	\item vérifier que les métadonnées sont bien comprises;
	\item \alert{associer l'\texttt{xsl} 2.0 de pré-traitement, \texttt{import\_xml\_filtre.xsl}};
	\item lancer l'import;
	\item (regarder le log de l'import);
	\item une fois l'import réussi, jeter un œil à la description, à l'édition, etc.
\end{enumerate}

\end{frame}


\section{Interroger les données}

\begin{frame}{\textsc{cqp} et \textsc{cql}}
	
	\begin{block}{Corpus Query Processor}
		Composant logiciel qui traite des requêtes:\\
		moteur de recherche qui permet de trouver toutes les occurrences
		correspondant à une requête.
		
		\begin{itemize}
			\item logiciel libre;
			\item développé initialement à l'Univ. de Stuttgart;
			\item \url{http://cwb.sourceforge.net/}.
		\end{itemize}
		
	\end{block}

	\begin{block}{Corpus Query Language}
		Langage d'expression de requêtes (cf. SQL, XQuery…).\\
		Une expression CQL est une chaîne de caractères exprimant un motif
		linguistique (un mot, ou une suite de mots) à partir des valeurs de leurs propriétés (comme la
		catégorie grammaticale, le lemme, la forme graphique). (voir Manuel de TXM).
	\end{block}
	
\end{frame}

\begin{frame}{Interroger avec \textsc{txm}: niveau 0}
	
	Entrer un mot dans le champ de l'interface \texttt{Index}.
	
	Ex. 'seigneur'.
	
\end{frame}

\begin{frame}{Interroger avec \textsc{txm}: niveau 1, assistant}

Cliquer sur la baguette magique, pour accéder à l'assistant de création de requêtes

Chercher:
\begin{itemize}
	\item la forme 'seigneur',
	\item suivie d'un pronom (cf. la doc, \\ \texttt{JeuEtiquettesModeleFrancaisTreeTagger.pdf}),
		\begin{itemize}
			\item astuce: commence par 'PRO'
		\end{itemize}
	\item suivi de n'importe quelle forme du lemme 'être'.
\end{itemize}

%TODO: screenshot (déjà enregistré)

\end{frame}

\begin{frame}{Interroger avec \textsc{txm}: niveau 2, un peu de \textsc{cql}}
	
	En \textsc{cql}, la requête précédente correspond à:\\
	\texttt{[word="seigneur"][frpos="PRO.*"] [frlemma="être"] }
	
	On se lance:
	\begin{enumerate}
		\item Modifier la requête pour permettre un mot, quel qu'il soit, entre seigneur et le pronom;
		\item la modifier, pour limiter aux cas où ce mot est une virgule;
		\item l'éditer pour étendre aux cas où ce mot est une virgule OU un point d'interrogation.
	\end{enumerate}
	
\end{frame}


\begin{frame}{Interroger avec \textsc{txm}: niveau 3, \textsc{cql} (plus) avancé}

\begin{columns}
	\begin{column}{0.48\textwidth}
		
		\begin{block}{Ignorer:}
			\begin{description}
				\item[\texttt{\%c}] casse, ex. \texttt{[word="état"\%c]}
				\item[\texttt{\%d}] diacritiques, ex. \texttt{[word="état"\%d]}
				\item[\texttt{\%d}] les deux, ex., \texttt{[word="état"\%cd]}
			\end{description}
		\end{block}

		\begin{block}{Opérateurs:}
			\begin{description}
				\item[=] égal
				\item[!=] différent
				\item[|] ou
				\item[\&] et
				\item[()] priorité des opérations
			\end{description}
		\end{block}		
		
	\end{column}
	\begin{column}{0.48\textwidth}
	
	\begin{block}{Quantificateurs}
		\begin{description}
			\item[mot] mot une seule fois (1);
			\item[mot+] mot une seule fois ou plus (1…n);
			\item[mot?] mot 0 ou une fois (0…1);
			\item[mot*] mot 0 fois ou plus (0…n);
			\item[mot\{2,4\}] mot entre 2 et 4 fois (2…4);
		\end{description}
	\end{block}
		
	\end{column}
\end{columns}


\end{frame}


\begin{frame}{Interroger avec \textsc{txm}: niveau 3, (suite)}

\begin{columns}
	\begin{column}{0.48\textwidth}
		
		\begin{block}{Échapper des caractères spéciaux}
			
			Pour entrer '?', '*', '.', '+', '|', '\&', …, qui sont des caractères spéciaux,\\
			les \textbf{faire précéder d'une barre oblique inverse}. Ex.,\\
			\texttt{\textbackslash?}
			
		\end{block}
		
	\end{column}
	\begin{column}{0.48\textwidth}
		
		
		\begin{block}{Classes de caractères}
		
		\begin{description}
			\item[.] n'importe quel caractère;
			\item[{[mn]}] un m ou un n;
			\item[{[a-z]}] une minuscule non accentuée;
			\item[{[\^~a-z]}] tout sauf … ;
			\item[\textbackslash{}d] un chiffre;
			\item[\textbackslash{}s] un caractère d'espacement;
			\item[\textbackslash{}w] un caractère de mot;
			\item[\textbackslash{}D] tout sauf un chiffre;
			\item[\textbackslash{}S] tout sauf un car. d'espacement;
			\item[\textbackslash{}W] tout sauf un car. de mot;
		\end{description}
		\end{block}
		
		
	\end{column}
\end{columns}


\end{frame}


\begin{frame}{Interroger avec \textsc{txm}: niveau 3, exercices}

\begin{enumerate}
	\item un mot contenant un chiffre.
	\item une forme commençant par 'a' et finissant par 'er';
	\item une forme de deux lettres: une voyelle et 'h';
	\item 'seigneur' ou 'dame', suivi ou non d'un mot et suivi d'un pronom (n'importe quel type de pronom).
	\item la forme 'je', suivie d'entre 2 et 4 mots, et d'une virgule.
\end{enumerate}

\end{frame}


\begin{frame}[fragile]
\frametitle{Interroger avec \textsc{txm}: niveau 4, \textsc{cql} \emph{hardcore}}
		
		\begin{block}{Expressions régulières plus avancées}
			\textbf{Classes de caractères Unicode}
			\begin{description}
				\item[\textbackslash{}p\{Lu\}] une majuscule (au sens de la propriété Unicode);
				\item[\textbackslash{}p\{P\}] une majuscule (au sens de la propriété Unicode);
				\item[\textit{etc.}]
			\end{description}
		\end{block}
		
		N.B.: \alert{Toutes les PCRE (Perl-Compatible Regular Expressions) sont disponibles dans \textsc{cql}}. 
		Voir  \href{http://regexkit.sourceforge.net/Documentation/pcre/pcrepattern.html}{\textcolor{blue}{la doc}}.
		
		%within, expand to, …
		
		\begin{block}{Instructions de \textsc{cql}}
			
			On peut limiter la zone de recherche en utilisant \texttt{within}.
			Ex. \\
			\verb|[word="et"][]*[word="je"] within 10|\\
			'et … je', dans une limite de 10 mots\\
			\verb|[word="et"][]*[word="je"] within l|\\
			'et … je', dans un vers.
		\end{block}

\end{frame}

\begin{frame}[fragile]
\frametitle{Interroger avec \textsc{txm}: niveau 4, suite}

\begin{block}{Utiliser les propriétés de structure}
	Possible d'utiliser les propriétés de structure et \textsc{xml} pour préciser les requêtes.
	
	\verb|<l> [frpos="VER.*"] [] * </l>|\\
	Vers commençant par un verbe.
	
	\verb|<l>  [] * [word=".*uite"] </l>|\\
	Vers ayant 'uite' à la rime.
	
\end{block}

\textit{Want more?} La \href{http://cwb.sourceforge.net/documentation.php}{\textcolor{blue}{doc de CQL}} est pour vous, ainsi que le 
\href{http://txm.sourceforge.net/doc/manual/manual1.xhtml}{\textcolor{blue}{manuel de TXM}}.

\end{frame}

\begin{frame}{Interroger avec \textsc{txm}: niveau 4, exercices}

\begin{enumerate}
	\item une forme contenant de la ponctuation;
	\item un vers d'entre 4 et 5 mots;
	\item un vers débutant par un pronom personnel (\texttt{PRO:PER}) débutant par 't';
	\item un vers se terminant par '-ron' (suivi ou non d'une consonne).
\end{enumerate}

\end{frame}

\section{Quelques notions d'analyse quantitative}

\begin{frame}[fragile]
\frametitle{Deux approches: la forme (style) ou le fond (sémantique)?}

\begin{description}
	\item[stylométrie] attribution, datation, localisation des textes. 
		\begin{itemize}
			\item information graphique, flexionnelle, etc. 
			\item \alert{mots les plus fréquents} (mots-outils, mots-vides), moins sensibles aux variations intentionnelles de leurs auteurs (genre, sujet, etc.).
		\end{itemize}
	\item[approche sémantique] (lexicométrie, lecture distante,…), à peu près l'inverse de la précédente: 
		\begin{itemize}
			\item lemmes;
			\item cooccurrents;
			\item mots plus rares.
		\end{itemize}
\end{description}

\end{frame}

%Partitions par genre, auteur, texte. Table-lexicale, lemmes ou formes

% Quelques stats desc?

% Problématique: les genres littéraires (thématique)

% Problématique: les auteurs (stylométrie)



\appendix

\begin{frame}{Solutions}{Interroger avec \textsc{txm}: niveau 2, un peu de \textsc{cql}}

\begin{enumerate}
	\item Modifier la requête pour permettre un mot, quel qu'il soit, entre seigneur et le pronom;\\
	\texttt{[word="seigneur"][][frpos="PRO.*"] [frlemma="être"]}
	\item la modifier, pour limiter aux cas où ce mot est une virgule;\\
	\texttt{[word="seigneur"][word=','][frpos="PRO.*"] [frlemma="être"] }
	\item l'éditer pour étendre aux cas où ce mot est une virgule OU un point d'interrogation.\\
	\texttt{[word="seigneur"][word=',' | word='\textbackslash?'][frpos="PRO.*"] [frlemma="être"] }
\end{enumerate}

\end{frame}

\begin{frame}[fragile]
\frametitle{Solutions}
\framesubtitle{Interroger avec \textsc{txm}: niveau 3, exercices}

\begin{enumerate}
	\item un mot contenant un chiffre.\\
	\texttt{[word=".*\textbackslash{}d.*"]}
	\item une forme commençant par 'a' et finissant par 'er';\\
	\texttt{[word="[a].*er"]}
	\item une forme de deux lettres: une voyelle et 'h';\\
	\texttt{[word="[aeiouy]h"]}
	\item 'seigneur' ou 'dame', suivi ou non d'un mot et suivi d'un pronom (n'importe quel type de pronom).\\
	\texttt{[word="seigneur" | word="dame"][]?[frpos="PRO.*"]}
	\item la forme 'je', suivie d'entre 2 et 4 mots, et d'une virgule.\\
	\texttt{[word="je"][]{2,4}[word=","]}
\end{enumerate}

\end{frame}

\begin{frame}[fragile]
\frametitle{Solutions}
\framesubtitle{Interroger avec \textsc{txm}: niveau 4, exercices}

\begin{enumerate}
	\item une forme contenant de la ponctuation;\\
	\verb|[word=".*\p{P}.*"]}|
	\item un vers d'entre 4 et 5 mots;\\
	\verb|<l>  []{4,5} </l>|
	\item un vers débutant par un pronom personnel (\texttt{PRO:PER}) débutant par 't';\\
	\verb|<l>  [word="t.*" & frpos="PRO:PER"] []* </l>|
	\item un vers se terminant par '-ron' (suivi ou non d'une consonne).\\
	\verb|<l>  [] * [word=".*ron[^aeiou]"] </l>|
\end{enumerate}

\end{frame}


\begin{frame}[fragile]
\frametitle{Bibliographie} 

\begin{thebibliography}{Heiden et al., 2010}
	\bibitem[Heiden et al., 2010]{Heiden2010} Heiden, S., Magué, J-P., et Pincemin, B., \og{}TXM: Une plateforme logicielle open-source pour la textométrie – conception et développement\fg{}, dans \textit{Proc. of 10th International Conference on the Statistical Analysis of Textual Data - JADT 2010}, éd. Sergio Bolasco, Isabella Chiari, Luca Giuliano, Rome, 2010, t.~2, p. 1021-1032, \url{https://halshs.archives-ouvertes.fr/halshs-00549779/fr/}.
	\bibitem[Pincemin et al., 2008]{Pincemin2008} Pincemin, Bénédicte, Céline Guillot, Serge Heiden, Alexei Lavrentiev, et Christiane Marchello-Nizia, « Usages linguistiques de la textométrie: analyse qualitative de la consultation de la Base de Français Médiéval via le logiciel Weblex », \textit{Syntaxe et Sémantique}, 9 (2008), p.~87–110, \url{https://halshs.archives-ouvertes.fr/halshs-00355461}.
	
	
	
\end{thebibliography}


\end{frame}


\end{document}
